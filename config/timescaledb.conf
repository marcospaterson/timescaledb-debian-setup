# TimescaleDB Specific Configuration
# Additional settings for TimescaleDB optimization
#
# Include this file in postgresql.conf with:
# include = 'timescaledb.conf'

#------------------------------------------------------------------------------
# TIMESCALEDB CORE SETTINGS
#------------------------------------------------------------------------------

# Background worker processes for TimescaleDB operations
timescaledb.max_background_workers = 8

# Disable telemetry (recommended for production)
timescaledb.telemetry_level = 'off'

# Enable TimescaleDB query optimizations
timescaledb.enable_optimizations = on

# Enable transparent decompression
timescaledb.enable_transparent_decompression = on

# Enable chunk-wise aggregation
timescaledb.enable_chunk_wise_aggregation = on

# Enable constraint-aware append
timescaledb.enable_constraint_aware_append = on

# Enable ordered append optimization
timescaledb.enable_ordered_append = on

#------------------------------------------------------------------------------
# CHUNK AND COMPRESSION SETTINGS
#------------------------------------------------------------------------------

# Default chunk time interval (can be overridden per hypertable)
# Recommended: 1 day for high-frequency data, 1 week for lower frequency
#timescaledb.chunk_time_interval = '1 day'

# Maximum number of chunks per hypertable
#timescaledb.max_chunks_per_table = 1000

# Compression settings
timescaledb.max_compression_workers = 4
#timescaledb.compress_segmentby_default = 'device_id'
#timescaledb.compress_orderby_default = 'time DESC'

#------------------------------------------------------------------------------
# MEMORY AND PERFORMANCE TUNING
#------------------------------------------------------------------------------

# Memory settings for TimescaleDB operations
# Adjust based on your system's available memory

# Memory for background jobs
timescaledb.bgw_memory_limit = '256MB'

# Memory for compression operations  
timescaledb.compression_memory_limit = '512MB'

# Parallelization settings
timescaledb.max_parallel_workers = 4
timescaledb.max_parallel_chunk_workers = 2

#------------------------------------------------------------------------------
# CONTINUOUS AGGREGATE SETTINGS
#------------------------------------------------------------------------------

# Enable continuous aggregate optimizations
timescaledb.enable_cagg_watermark_constify = on

# Continuous aggregate refresh settings
timescaledb.materialization_workers = 2
timescaledb.max_materialization_workers = 4

#------------------------------------------------------------------------------
# RETENTION AND MAINTENANCE
#------------------------------------------------------------------------------

# Automatic retention job settings
timescaledb.enable_automatic_retention = on

# Background job scheduling
timescaledb.job_scheduler_interval = '30s'
timescaledb.job_executor_timeout = '30min'

# Statistics collection for TimescaleDB
timescaledb.enable_chunk_stats = on

#------------------------------------------------------------------------------
# EXPERIMENTAL AND ADVANCED FEATURES
#------------------------------------------------------------------------------

# Enable experimental features (use with caution in production)
#timescaledb.enable_experimental_features = off

# Advanced compression options
#timescaledb.enable_compression_wal_markers = on
#timescaledb.enable_decompression_sorted_merge = on

# Multi-node settings (for TimescaleDB distributed setups)
#timescaledb.enable_distributed_insert = on
#timescaledb.enable_remote_explain = on
#timescaledb.max_distributed_insert_batch = 1000

#------------------------------------------------------------------------------
# MONITORING AND DEBUGGING
#------------------------------------------------------------------------------

# Enable TimescaleDB specific logging
#timescaledb.enable_job_logging = on
#timescaledb.log_level = 'WARNING'

# Debug settings (disable in production)
#timescaledb.debug_compression = off
#timescaledb.debug_continuous_aggs = off

#------------------------------------------------------------------------------
# NOTES AND RECOMMENDATIONS
#------------------------------------------------------------------------------
#
# 1. Chunk Interval Selection:
#    - High-frequency data (seconds): 1 hour to 1 day
#    - Medium-frequency data (minutes): 1 day to 1 week  
#    - Low-frequency data (hours): 1 week to 1 month
#
# 2. Compression Strategy:
#    - Enable compression for older data (>24 hours)
#    - Segment by high-cardinality dimensions
#    - Order by time DESC for better compression
#
# 3. Memory Allocation:
#    - Total TimescaleDB memory should be <25% of system RAM
#    - Adjust worker counts based on CPU cores
#    - Monitor memory usage under load
#
# 4. Performance Monitoring:
#    - Use pg_stat_statements for query analysis
#    - Monitor chunk exclusion effectiveness
#    - Track compression ratios and performance
#
#------------------------------------------------------------------------------
